{"version":3,"sources":["GameplayManager.js"],"names":["Global","require","DifficultyLevel","cc","Class","name","properties","lengthInPoints","default","type","Integer","probDouble","probTriple","speedMultiplier","probHalfDelay","extends","Component","currentLevel","get","levels","currentLevelIndex","lights","Node","currentScore","currentIndexInLevel","currentTime","nextFireTime","dead","onLoad","GameplayManager","start","increaseScore","log","length","fireOneRound","i","chooseNextFireAmount","lightIndex","Math","floor","random","lightNode","light","getComponent","fireImg","active","fire","chooseNextFireDelay","prepareNextFire","delay","lose","update","dt"],"mappings":"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","file":"GameplayManager.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var Global = require(\"Global\");\n\nvar DifficultyLevel = cc.Class({\n\tname: \"DifficultyLevel\",\n\tproperties: {\n       lengthInPoints: {\n       \t\tdefault: 0,\n       \t\ttype: cc.Integer,\n       },\n \t   probDouble: 0,\n \t   probTriple: 0,\n \t   speedMultiplier: 1,\n \t   probHalfDelay: 0,\n    },\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n         currentLevel: {\n     \t\tget () {\n                 return this.levels[this.currentLevelIndex];\n             },\n         },\n       lights: {\n            default: [],\n            type: [cc.Node],\n       },\n       levels: {\n            default: [],\n            type: [DifficultyLevel],\n       },\n       \n       currentScore: {\n       \t\tdefault: 0,\n       \t\ttype: cc.Integer,\n       },\n       \n       currentLevelIndex: {\n       \t\tdefault: 0,\n       \t\ttype: cc.Integer,\n       },\n       \n       currentIndexInLevel: {\n       \t\tdefault: 0,\n       \t\ttype: cc.Integer,\n       },\n       \n       currentTime: 0,\n       \n       nextFireTime: 0,\n       \n       dead: false,\n       \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n     onLoad () {\n     \tGlobal.GameplayManager = this;\n     },\n\n    start () {\n    },\n    \n    increaseScore () {\n    \tthis.currentScore++;\n\t\tcc.log (\"increaseScore: \" + this.currentScore);\n    \tthis.currentIndexInLevel++;\n    \tif (this.currentLevelIndex < this.levels.length - 1 && this.currentIndexInLevel >= this.currentLevel.lengthInPoints)\n    \t{\n    \t\tthis.currentLevelIndex++;\n    \t\tthis.currentIndexInLevel = 0;\n\t\t\tcc.log (\"increaseLevel: \" + this.currentLevelIndex);\n    \t}\n    },\n\n\tfireOneRound () {\n\t\tcc.log(\"fireOneRound\");\n\t\tfor (i = 0 ; i < this.chooseNextFireAmount () ; i++)\n\t\t{\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar lightIndex = Math.floor (Math.random() * 9);\n\t\t\t\tvar lightNode = this.lights[lightIndex];\n\t\t\t\tvar light = lightNode.getComponent(\"Light\");\n\t\t\t\tif (!light.fireImg.active)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlight.fire ();\n\t\t}\n\t},\n\t\n\tchooseNextFireAmount () {\n\t\tif (Math.random() <= this.currentLevel.probTriple)\n\t\t\treturn 3;\n\t\telse if (Math.random() <= this.currentLevel.probTriple + this.currentLevel.probDouble)\n\t\t\treturn 2;\n\t\telse\n\t\t\treturn 1;\n\t},\n\t\n\tchooseNextFireDelay () {\n\t\tif (Math.random() <= this.currentLevel.probHalfDelay)\n\t\t\treturn 0.5;\n\t\telse\n\t\t\treturn 1;\n\t},\n\t\n\tprepareNextFire () {\n\t\tcc.log(\"prepareNextFire\");\n\t\tvar delay = this.chooseNextFireDelay ();\n\t\tthis.nextFireTime += delay;\n\t},\n\t\n\tlose () {\n\t\tcc.log (\"Loser\");\n\t\tthis.dead = true;\n\t},\n\t\n     update (dt) {\n     \tif (this.dead)\n     \t\treturn;\n     \tthis.currentTime += dt;\n     \tif (this.currentTime >= this.nextFireTime)\n     \t{\n     \t\tthis.fireOneRound (); \t\t\n\t\t\tthis.prepareNextFire ();\n     \t}\n     \n     },\n});\n"]}